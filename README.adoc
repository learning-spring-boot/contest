image::https://raw.githubusercontent.com/maciejwalkowiak/contest/gh-pages/mercury.png[]

image:https://drone.io/github.com/maciejwalkowiak/contest/status.png[link=https://drone.io/github.com/maciejwalkowiak/contest/latest]

____
In Roman mythology *Mercury* is the patron god of messages and communication.
____

*Mercury* is an application initially created for _Learning Spring Boot_
contest.

TIP: If you like the application *star* this Github repository and
*tweet* about it with #mercuryapp hashtag.

Mercury goal is to provide single **HTTP API** to send notifications in a company with internal applications in mind.

== Use case

Quite often there are many custom internal applications used in companies: HR, accounting, business trips, bug trackers and so on.
Each one of them sends some notification to employees and developers have to solve same problems:

* mail server connection configuration
* sending emails in async manner
* queue

If mail server location or account changes it's details each application has to be reconfigured.

== Features

* sending email through *Java Mail*
* sending email through *https://sendgrid.com/[SendGrid]*
* sending messages to *https://slack.com[Slack]*
* asynchronous message processing - all incoming requests are saved in queue and processed by consumers
* messages are stored in *MongoDB* - you can anytime check if notification has been sent or not and what's the error message if there is any
* health checks - you can easily check if mail server/SendGrid connection is not misconfigured

Upcoming features:

* metrics

== API

Exposed API is dynamic - meaning that depending on what notifications provider is configured - corresponding endpoint is available.
For example if properties `slack.url` is not set handler for URL `http://<host>:<port>/api/slack` is not created.

=== List API methods

----
GET,OPTIONS /api/
----

==== Response

----
Status: 200 OK

{
  "links":[
     {
        "rel":"self",
        "href":"http://localhost:8082/api"
     },
     {
        "rel":"message",
        "href":"http://localhost:8082/api/message/{id}"
     },
     {
        "rel":"mail",
        "href":"http://localhost:8082/api/mail"
     },       {
        "rel":"slack",
        "href":"http://localhost:8082/api/slack"
     }
   ]
}
----

=== Get message

----
GET /api/message/{id}
----

==== Response

----
Status: 200 OK

{
   "id":"54b992023004a2bf10dcaf98",
   "status":"FAILED",
   "errorMessage":"Mailing provider is not configured",
   "request":{
      "to":[
         "john.doe@mercuryapp.com"
      ],
      "cc":[

      ],
      "bcc":[

      ],
      "text":"Hello John",
      "subject":"It's been a long time"
   }
}
----

=== Send email

TIP: available only if *Java Mail* or *SendGrid* is configured

----
POST /api/mail
----

==== Request

----
{
   "to":[
      "john.doe@mercuryapp.com"
   ],
   "text":"Hello John",
   "subject":"It's been a long time"
}
----

==== Response

----
Status: 201 CREATED
Location: http://localhost:8082/api/message/54b992023004a2bf10dcaf98
----

=== Send Slack message

TIP: available only if *Slack* is configured

----
POST /api/slack
----

==== Request

----
{
   "text":"hello from slack!",
   "icon_emoji":":chart_with_upwards_trend:",
   "channel":"#urgent"
}
----

==== Response

----
Status: 201 CREATED
Location: http://localhost:8082/api/message/54b992023004a2bf10dcaf98
----

== How to run

* install required software: Java 8 and MongoDB
* https://github.com/maciejwalkowiak/contest/releases/[Download latest release]
* configure `config/application.properties`
* run with `java -jar mercury-<version>.jar`
* go to `http://localhost:8080/api`

== Configuration options

All *Mercury* configuration is stored in `config/application.properties` that you find in distribution package.

=== Database configuration

*Mercury* can persist messages with their statuses to MongoDB or save them into in-memory database that disappears when application goes down.

For in-memory configuration make sure configuration contains following line:

----
mercury.db.inMemory=true
----

For MongoDB configuration make sure that property *mercury.db.inMemory* does not exist or is set to *false* and put following configuration properties:

----
spring.data.mongodb.uri=mongodb://localhost/test # connection URL
spring.data.mongodb.database=
spring.data.mongodb.username=
spring.data.mongodb.password=
----

=== Services configuration

In the same place you can configure configuration to services. Configuration properties presence activates related service (make sure to delete *#* at the beginning of each property you wish to use):

----
# JavaMail configuration - optional
#spring.mail.host=
#spring.mail.port=
#spring.mail.username=
#spring.mail.password=

# SendGrid configuration - optional
#sendgrid.username=
#sendgrid.password=

# Slack configuration - optional
#slack.hook.url=
----

To configure additional Java Mail properties use
`spring.mail.properties` prefix.

Sample configuration for Gmail account:

-----------------------------------------------------
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=<username>
spring.mail.password=<password>
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
-----------------------------------------------------

*IMPORTANT:* if both Java Mail *and* SendGrid configuration is provided
- all emails will be sent using SendGrid.

Learn more about Slack webhooks at https://api.slack.com/

Additionally, since *Mercury* is based on *Spring Boot* you can use pretty much any of configuration property described in Boot docs: http://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html
