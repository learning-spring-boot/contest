= Mercury
-----------

image:https://drone.io/github.com/maciejwalkowiak/contest/status.png[link=https://drone.io/github.com/maciejwalkowiak/contest/latest]

____
In Roman mythology *Mercury* is the patron god of messages and communication.
____

*Mercury* is an application initially created for _Learning Spring Boot_
contest.

TIP: If you like the application *star* this Github repository and
*tweet* about it with #mercuryapp hashtag.

Mercury goal is to provide single **HTTP API** to send notifications in a company with internal applications in mind.

== Use case

Quite often there are many custom internal applications used in companies: HR, accounting, business trips, bug trackers and so on.
Each one of them sends some notification to employees and developers have to solve same problems:

* mail server connection configuration
* sending emails in async manner
* queue

If mail server location or account changes it's details each application has to be reconfigured.

== Features

* sending email through *Java Mail*
* sending email through *SendGrid*
* asynchronous message processing - all incoming requests are saved in queue and processed by consumers
* messages are stored in *MongoDB* - you can anytime check if notification has been sent or not and what's the error message if there is any
* health checks - you can easily check if mail server/SendGrid connection is not misconfigured

Upcoming features:

* *Slack* integration
* metrics

== API

Exposed API is dynamic - meaning that depending on what notifications provider is configured - corresponding endpoint is available.
For example if properties `slack.url` is not set handler for URL `http://<host>:<port>/api/slack` is not created.

* `GET http://<host>:<port>/api/` - lists all available API methods in current configuration
* `GET http://<host>:<port>/api/message/{id}` - get message status
* `POST http://<host>:<port>/api/mail` - sends mail message - available only if *Java Mail* or *SendGrid* is configured

== Build & Install

*Mercury* uses MongoDB to store messages data. Make sure you have running MongoDB instance and appropriate configuration.

Currently in order to use **Mercury** you need to build it first.

. `git clone https://github.com/maciejwalkowiak/contest.git`
. `cd contest`
. `mvn package`
. Copy JAR file to some location for example `/opt/mercuryapp`: `cp target/mercury-0.0.1-SNAPSHOT.jar /opt/mercuryapp`
. Inside `/opt/mercuryapp` create file `application.properties` and configure mail providers
. Execute `java -jar mercury-0.0.1-SNAPSHOT.jar`

== Configuration options

=== MongoDB configuration

------------------------------------------------------------------------
spring.data.mongodb.uri=mongodb://localhost/test # connection URL
spring.data.mongodb.database=
spring.data.mongodb.username=
spring.data.mongodb.password=
------------------------------------------------------------------------

=== Java Mail configuration

Put following properties to `application.properties` file:

---------------------
spring.mail.host=
spring.mail.port=
spring.mail.username=
spring.mail.password=
---------------------

To configure additional Java Mail properties use
`spring.mail.properties` prefix.

Sample configuration for Gmail account:

-----------------------------------------------------
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=<username>
spring.mail.password=<password>
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
-----------------------------------------------------

=== SendGrid configuration

Put following properties to `application.properties` file:

------------------
sendgrid.username=
sendgrid.password=
------------------

If you need to access SendGrid through proxy server add:

--------------------
sendgrid.proxy.host=
sendgrid.proxy.port=
--------------------

*IMPORTANT:* if both Java Mail *and* SendGrid configuration is provided
- all emails will be sent using SendGrid.
